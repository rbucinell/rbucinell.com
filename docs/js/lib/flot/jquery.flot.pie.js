!function(e){var t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:function(s){function a(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(X+=i)}}function r(i,s,a,r){S||(S=!0,M=i.getCanvas(),k=e(M).parent(),t=i.getOptions(),i.setData(o(i.getData())))}function l(){L=k.children().filter(".legend").children().width(),m=Math.min(M.width,M.height/t.series.pie.tilt)/2,I=M.height/2+t.series.pie.offset.top,A=M.width/2,"auto"==t.series.pie.offset.left?t.legend.position.match("w")?A+=L/2:A-=L/2:A+=t.series.pie.offset.left,A<m?A=m:A>M.width-m&&(A=M.width-m)}function n(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:void 0!==e[t].data&&void 0!==e[t].data[0]||(void 0!==e[t].data&&void 0!==e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}function o(e){a(e=n(e));for(var i=0,s=0,r=t.series.pie.combine.color,l=[],o=0;o<e.length;++o)e[o].data[0][1]=parseFloat(e[o].data[0][1]),e[o].data[0][1]||(e[o].data[0][1]=0),e[o].data[0][1]/X<=t.series.pie.combine.threshold?(i+=e[o].data[0][1],s++,r||(r=e[o].color)):l.push({data:[[1,e[o].data[0][1]]],color:e[o].color,label:e[o].label,angle:e[o].data[0][1]*(2*Math.PI)/X,percent:e[o].data[0][1]/X*100});return s>0&&l.push({data:[[1,i]],color:r,label:t.series.pie.combine.label,angle:i*(2*Math.PI)/X,percent:i/X*100}),l}function p(i,s){function a(){ctx.clearRect(0,0,M.width,M.height),k.children().filter(".pieLabel, .pieLabelBackground").remove()}if(k){ctx=s,l();for(var r=i.getData(),n=0;Y&&n<R;)Y=!1,n>0&&(m*=O),n+=1,a(),t.series.pie.tilt<=.8&&function(){if(t.series.pie.radius>1)e=t.series.pie.radius;else var e=m*t.series.pie.radius;if(!(e>=M.width/2-5||e*t.series.pie.tilt>=M.height/2-15||e<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(A,I),ctx.scale(1,t.series.pie.tilt);for(var i=1;i<=10;i++)ctx.beginPath(),ctx.arc(0,0,e,0,2*Math.PI,!1),ctx.fill(),e-=i;ctx.restore()}}(),function(){function i(t,i,r){t<=0||(r?ctx.fillStyle=i:(ctx.strokeStyle=i,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(t-2*Math.PI)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(t-=1e-4),ctx.arc(0,0,s,a,a+t,!1),ctx.closePath(),a+=t,r?ctx.fill():ctx.stroke())}if(startAngle=Math.PI*t.series.pie.startAngle,t.series.pie.radius>1)s=t.series.pie.radius;else var s=m*t.series.pie.radius;ctx.save(),ctx.translate(A,I),ctx.scale(1,t.series.pie.tilt),ctx.save();for(var a=startAngle,l=0;l<r.length;++l)r[l].startAngle=a,i(r[l].angle,r[l].color,!0);for(ctx.restore(),ctx.save(),ctx.lineWidth=t.series.pie.stroke.width,a=startAngle,l=0;l<r.length;++l)i(r[l].angle,t.series.pie.stroke.color,!1);ctx.restore(),c(ctx),t.series.pie.label.show&&function(){var i=startAngle;if(t.series.pie.label.radius>1)s=t.series.pie.label.radius;else var s=m*t.series.pie.label.radius;for(var a=0;a<r.length;++a)r[a].percent>=100*t.series.pie.label.threshold&&function(i,a,r){if(0!=i.data[0][1]){var l,n=t.legend.labelFormatter,o=t.series.pie.label.formatter;l=n?n(i.label,i):i.label,o&&(l=o(l,i));var p=(a+i.angle+a)/2,c=A+Math.round(Math.cos(p)*s),h=I+Math.round(Math.sin(p)*s)*t.series.pie.tilt,d='<span class="pieLabel" id="pieLabel'+r+'" style="position:absolute;top:'+h+"px;left:"+c+'px;">'+l+"</span>";k.append(d);var u=k.children("#pieLabel"+r),g=h-u.height()/2,f=c-u.width()/2;if(u.css("top",g),u.css("left",f),(0-g>0||0-f>0||M.height-(g+u.height())<0||M.width-(f+u.width())<0)&&(Y=!0),0!=t.series.pie.label.background.opacity){var v=t.series.pie.label.background.color;null==v&&(v=i.color);var b="top:"+g+"px;left:"+f+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+u.width()+"px;height:"+u.height()+"px;"+b+"background-color:"+v+';"> </div>').insertBefore(u).css("opacity",t.series.pie.label.background.opacity)}}}(r[a],i,a),i+=r[a].angle}(),ctx.restore()}();n>=R&&(a(),k.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),i.setSeries&&i.insertLegend&&(i.setSeries(r),i.insertLegend())}}function c(e){t.series.pie.innerRadius>0&&(e.save(),innerRadius=t.series.pie.innerRadius>1?t.series.pie.innerRadius:m*t.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function h(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}function d(e,t){for(var i=s.getData(),a=s.getOptions(),r=a.series.pie.radius>1?a.series.pie.radius:m*a.series.pie.radius,l=0;l<i.length;++l){var n=i[l];if(n.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,r,n.startAngle,n.startAngle+n.angle,!1),ctx.closePath(),x=e-A,y=t-I,ctx.isPointInPath){if(ctx.isPointInPath(e-A,t-I))return ctx.restore(),{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:l}}else if(p1X=r*Math.cos(n.startAngle),p1Y=r*Math.sin(n.startAngle),p2X=r*Math.cos(n.startAngle+n.angle/4),p2Y=r*Math.sin(n.startAngle+n.angle/4),p3X=r*Math.cos(n.startAngle+n.angle/2),p3Y=r*Math.sin(n.startAngle+n.angle/2),p4X=r*Math.cos(n.startAngle+n.angle/1.5),p4Y=r*Math.sin(n.startAngle+n.angle/1.5),p5X=r*Math.cos(n.startAngle+n.angle),p5Y=r*Math.sin(n.startAngle+n.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],h(arrPoly,arrPoint))return ctx.restore(),{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:l};ctx.restore()}}return null}function u(e){f("plothover",e)}function g(e){f("plotclick",e)}function f(e,i){var a=s.offset(),r=d(parseInt(i.pageX-a.left),parseInt(i.pageY-a.top));if(t.grid.autoHighlight)for(var l=0;l<F.length;++l){var n=F[l];n.auto!=e||r&&n.series==r.series||b(n.series)}r&&v(r.series,e);var o={pageX:i.pageX,pageY:i.pageY};k.trigger(e,[o,r])}function v(e,t){"number"==typeof e&&(e=series[e]);var i=w(e);-1==i?(F.push({series:e,auto:t}),s.triggerRedrawOverlay()):t||(F[i].auto=!1)}function b(e){null==e&&(F=[],s.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var t=w(e);-1!=t&&(F.splice(t,1),s.triggerRedrawOverlay())}function w(e){for(var t=0;t<F.length;++t)if(F[t].series==e)return t;return-1}function P(e,t){var s=e.getOptions(),a=s.series.pie.radius>1?s.series.pie.radius:m*s.series.pie.radius;for(t.save(),t.translate(A,I),t.scale(1,s.series.pie.tilt),i=0;i<F.length;++i)!function(e){e.angle<0||(t.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,a,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill())}(F[i].series);c(t),t.restore()}var M=null,k=null,m=null,A=null,I=null,X=0,Y=!0,R=10,O=.95,L=0,S=!1,F=[];s.hooks.processOptions.push(function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(r),e.hooks.drawOverlay.push(P),e.hooks.draw.push(p))}),s.hooks.bindEvents.push(function(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(u),i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(g)})},options:t,name:"pie",version:"1.0"})}(jQuery);