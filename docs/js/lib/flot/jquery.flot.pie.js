!function(I){var X={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};I.plot.plugins.push({init:function(p){var o=null,c=null,n=null,h=null,d=null,l=0,g=!0,u=10,f=.95,b=0,a=!1,v=[];function s(e,t,i,s){a||(a=!0,o=e.getCanvas(),c=I(o).parent(),X=e.getOptions(),e.setData(function(e){!function(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(l+=i)}}(e=function(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:void 0!==e[t].data&&void 0!==e[t].data[0]||(void 0!==e[t].data&&void 0!==e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}(e));for(var t=0,i=0,s=X.series.pie.combine.color,a=[],r=0;r<e.length;++r)e[r].data[0][1]=parseFloat(e[r].data[0][1]),e[r].data[0][1]||(e[r].data[0][1]=0),e[r].data[0][1]/l<=X.series.pie.combine.threshold?(t+=e[r].data[0][1],i++,s=s||e[r].color):a.push({data:[[1,e[r].data[0][1]]],color:e[r].color,label:e[r].label,angle:e[r].data[0][1]*(2*Math.PI)/l,percent:e[r].data[0][1]/l*100});0<i&&a.push({data:[[1,t]],color:s,label:X.series.pie.combine.label,angle:t*(2*Math.PI)/l,percent:t/l*100});return a}(e.getData())))}function r(e,t){if(c){ctx=t,b=c.children().filter(".legend").children().width(),n=Math.min(o.width,o.height/X.series.pie.tilt)/2,d=o.height/2+X.series.pie.offset.top,h=o.width/2,"auto"==X.series.pie.offset.left?X.legend.position.match("w")?h+=b/2:h-=b/2:h+=X.series.pie.offset.left,h<n?h=n:h>o.width-n&&(h=o.width-n);for(var i,l=e.getData(),s=0;g&&s<u;){if(g=!1,0<s&&(n*=f),s+=1,r(),X.series.pie.tilt<=.8)if(a=i=void 0,!((i=1<X.series.pie.radius?X.series.pie.radius:n*X.series.pie.radius)>=o.width/2-5||i*X.series.pie.tilt>=o.height/2-15||i<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(h,d),ctx.scale(1,X.series.pie.tilt);for(var a=1;a<=10;a++)ctx.beginPath(),ctx.arc(0,0,i,0,2*Math.PI,!1),ctx.fill(),i-=a;ctx.restore()}!function(){{var s;startAngle=Math.PI*X.series.pie.startAngle,s=1<X.series.pie.radius?X.series.pie.radius:n*X.series.pie.radius}ctx.save(),ctx.translate(h,d),ctx.scale(1,X.series.pie.tilt),ctx.save();for(var a=startAngle,e=0;e<l.length;++e)l[e].startAngle=a,t(l[e].angle,l[e].color,!0);ctx.restore(),ctx.save(),ctx.lineWidth=X.series.pie.stroke.width,a=startAngle;for(e=0;e<l.length;++e)t(l[e].angle,X.series.pie.stroke.color,!1);ctx.restore(),w(ctx),X.series.pie.label.show&&function(){var e=startAngle;{var r;r=1<X.series.pie.label.radius?X.series.pie.label.radius:n*X.series.pie.label.radius}for(var t=0;t<l.length;++t)l[t].percent>=100*X.series.pie.label.threshold&&!function(e,t,i){var s,a;0!=e.data[0][1]&&(s=X.legend.labelFormatter,a=X.series.pie.label.formatter,s=s?s(e.label,e):e.label,a&&(s=a(s,e)),a=(t+e.angle+t)/2,t=h+Math.round(Math.cos(a)*r),a=d+Math.round(Math.sin(a)*r)*X.series.pie.tilt,s='<span class="pieLabel" id="pieLabel'+i+'" style="position:absolute;top:'+a+"px;left:"+t+'px;">'+s+"</span>",c.append(s),s=c.children("#pieLabel"+i),i=a-s.height()/2,a=t-s.width()/2,s.css("top",i),s.css("left",a),(0<0-i||0<0-a||o.height-(i+s.height())<0||o.width-(a+s.width())<0)&&(g=!0),0!=X.series.pie.label.background.opacity&&(null==(t=X.series.pie.label.background.color)&&(t=e.color),e="top:"+i+"px;left:"+a+"px;",I('<div class="pieLabelBackground" style="position:absolute;width:'+s.width()+"px;height:"+s.height()+"px;"+e+"background-color:"+t+';"> </div>').insertBefore(s).css("opacity",X.series.pie.label.background.opacity)))}(l[t],e,t),e+=l[t].angle}();function t(e,t,i){e<=0||(i?ctx.fillStyle=t:(ctx.strokeStyle=t,ctx.lineJoin="round"),ctx.beginPath(),1e-9<Math.abs(e-2*Math.PI)?ctx.moveTo(0,0):I.browser.msie&&(e-=1e-4),ctx.arc(0,0,s,a,a+e,!1),ctx.closePath(),a+=e,i?ctx.fill():ctx.stroke())}ctx.restore()}()}u<=s&&(r(),c.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),e.setSeries&&e.insertLegend&&(e.setSeries(l),e.insertLegend())}function r(){ctx.clearRect(0,0,o.width,o.height),c.children().filter(".pieLabel, .pieLabelBackground").remove()}}function w(e){0<X.series.pie.innerRadius&&(e.save(),innerRadius=1<X.series.pie.innerRadius?X.series.pie.innerRadius:n*X.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=X.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=X.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function P(e,t){for(var i=p.getData(),s=p.getOptions(),a=1<s.series.pie.radius?s.series.pie.radius:n*s.series.pie.radius,r=0;r<i.length;++r){var l=i[r];if(l.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,a,l.startAngle,l.startAngle+l.angle,!1),ctx.closePath(),x=e-h,y=t-d,ctx.isPointInPath){if(ctx.isPointInPath(e-h,t-d))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:r}}else if(p1X=a*Math.cos(l.startAngle),p1Y=a*Math.sin(l.startAngle),p2X=a*Math.cos(l.startAngle+l.angle/4),p2Y=a*Math.sin(l.startAngle+l.angle/4),p3X=a*Math.cos(l.startAngle+l.angle/2),p3Y=a*Math.sin(l.startAngle+l.angle/2),p4X=a*Math.cos(l.startAngle+l.angle/1.5),p4Y=a*Math.sin(l.startAngle+l.angle/1.5),p5X=a*Math.cos(l.startAngle+l.angle),p5Y=a*Math.sin(l.startAngle+l.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],function(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}(arrPoly,arrPoint))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:r};ctx.restore()}}return null}function M(e){t("plothover",e)}function k(e){t("plotclick",e)}function t(e,t){var i,s,a=p.offset(),r=P(parseInt(t.pageX-a.left),parseInt(t.pageY-a.top));if(X.grid.autoHighlight)for(var l=0;l<v.length;++l){var o=v[l];if(!(o.auto!=e||r&&o.series==r.series)){n=n=void 0;var n=o.series;null==n&&(v=[],p.triggerRedrawOverlay()),-1!=(n=m(n="number"==typeof n?series[n]:n))&&(v.splice(n,1),p.triggerRedrawOverlay())}}r&&(a=r.series,i=e,"number"==typeof a&&(a=series[a]),-1==(s=m(a))?(v.push({series:a,auto:i}),p.triggerRedrawOverlay()):i||(v[s].auto=!1));a={pageX:t.pageX,pageY:t.pageY};c.trigger(e,[a,r])}function m(e){for(var t=0;t<v.length;++t)if(v[t].series==e)return t;return-1}function A(e,t){var s,a=e.getOptions(),r=1<a.series.pie.radius?a.series.pie.radius:n*a.series.pie.radius;for(t.save(),t.translate(h,d),t.scale(1,a.series.pie.tilt),i=0;i<v.length;++i)(s=v[i].series).angle<0||(t.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",t.beginPath(),1e-9<Math.abs(s.angle-2*Math.PI)&&t.moveTo(0,0),t.arc(0,0,r,s.startAngle,s.startAngle+s.angle,!1),t.closePath(),t.fill());w(t),t.restore()}p.hooks.processOptions.push(function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),1<t.series.pie.tilt&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(s),e.hooks.drawOverlay.push(A),e.hooks.draw.push(r))}),p.hooks.bindEvents.push(function(e,t){e=e.getOptions();e.series.pie.show&&e.grid.hoverable&&t.unbind("mousemove").mousemove(M);e.series.pie.show&&e.grid.clickable&&t.unbind("click").click(k)})},options:X,name:"pie",version:"1.0"})}(jQuery);