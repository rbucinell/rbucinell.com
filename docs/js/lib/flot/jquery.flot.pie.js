!function(X){var Y={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};X.plot.plugins.push({init:function(n){var v=null,b=null,o=null,w=null,P=null,l=0,M=!0,p=10,c=.95,h=0,a=!1,d=[];function s(e,t,i,s){a||(a=!0,v=e.getCanvas(),b=X(v).parent(),Y=e.getOptions(),e.setData(function(e){!function(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(l+=i)}}(e=function(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:void 0!==e[t].data&&void 0!==e[t].data[0]||(void 0!==e[t].data&&void 0!==e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}(e));for(var t=0,i=0,s=Y.series.pie.combine.color,a=[],r=0;r<e.length;++r)e[r].data[0][1]=parseFloat(e[r].data[0][1]),e[r].data[0][1]||(e[r].data[0][1]=0),e[r].data[0][1]/l<=Y.series.pie.combine.threshold?(t+=e[r].data[0][1],i++,s||(s=e[r].color)):a.push({data:[[1,e[r].data[0][1]]],color:e[r].color,label:e[r].label,angle:e[r].data[0][1]*(2*Math.PI)/l,percent:e[r].data[0][1]/l*100});return 0<i&&a.push({data:[[1,t]],color:s,label:Y.series.pie.combine.label,angle:t*(2*Math.PI)/l,percent:t/l*100}),a}(e.getData())))}function r(e,t){if(b){ctx=t,h=b.children().filter(".legend").children().width(),o=Math.min(v.width,v.height/Y.series.pie.tilt)/2,P=v.height/2+Y.series.pie.offset.top,w=v.width/2,"auto"==Y.series.pie.offset.left?Y.legend.position.match("w")?w+=h/2:w-=h/2:w+=Y.series.pie.offset.left,w<o?w=o:w>v.width-o&&(w=v.width-o);for(var r=e.getData(),i=0;M&&i<p;)M=!1,0<i&&(o*=c),i+=1,s(),Y.series.pie.tilt<=.8&&a(),l();p<=i&&(s(),b.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),e.setSeries&&e.insertLegend&&(e.setSeries(r),e.insertLegend())}function s(){ctx.clearRect(0,0,v.width,v.height),b.children().filter(".pieLabel, .pieLabelBackground").remove()}function a(){if(1<Y.series.pie.radius)var e=Y.series.pie.radius;else e=o*Y.series.pie.radius;if(!(e>=v.width/2-5||e*Y.series.pie.tilt>=v.height/2-15||e<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(w,P),ctx.scale(1,Y.series.pie.tilt);for(var t=1;t<=10;t++)ctx.beginPath(),ctx.arc(0,0,e,0,2*Math.PI,!1),ctx.fill(),e-=t;ctx.restore()}}function l(){if(startAngle=Math.PI*Y.series.pie.startAngle,1<Y.series.pie.radius)var s=Y.series.pie.radius;else s=o*Y.series.pie.radius;ctx.save(),ctx.translate(w,P),ctx.scale(1,Y.series.pie.tilt),ctx.save();for(var a=startAngle,e=0;e<r.length;++e)r[e].startAngle=a,t(r[e].angle,r[e].color,!0);for(ctx.restore(),ctx.save(),ctx.lineWidth=Y.series.pie.stroke.width,a=startAngle,e=0;e<r.length;++e)t(r[e].angle,Y.series.pie.stroke.color,!1);function t(e,t,i){e<=0||(i?ctx.fillStyle=t:(ctx.strokeStyle=t,ctx.lineJoin="round"),ctx.beginPath(),1e-9<Math.abs(e-2*Math.PI)?ctx.moveTo(0,0):X.browser.msie&&(e-=1e-4),ctx.arc(0,0,s,a,a+e,!1),ctx.closePath(),a+=e,i?ctx.fill():ctx.stroke())}ctx.restore(),g(ctx),Y.series.pie.label.show&&function(){var e=startAngle;if(1<Y.series.pie.label.radius)var f=Y.series.pie.label.radius;else var f=o*Y.series.pie.label.radius;for(var t=0;t<r.length;++t)r[t].percent>=100*Y.series.pie.label.threshold&&i(r[t],e,t),e+=r[t].angle;function i(e,t,i){if(0!=e.data[0][1]){var s,a=Y.legend.labelFormatter,r=Y.series.pie.label.formatter;s=a?a(e.label,e):e.label,r&&(s=r(s,e));var l=(t+e.angle+t)/2,n=w+Math.round(Math.cos(l)*f),o=P+Math.round(Math.sin(l)*f)*Y.series.pie.tilt,p='<span class="pieLabel" id="pieLabel'+i+'" style="position:absolute;top:'+o+"px;left:"+n+'px;">'+s+"</span>";b.append(p);var c=b.children("#pieLabel"+i),h=o-c.height()/2,d=n-c.width()/2;if(c.css("top",h),c.css("left",d),(0<0-h||0<0-d||v.height-(h+c.height())<0||v.width-(d+c.width())<0)&&(M=!0),0!=Y.series.pie.label.background.opacity){var g=Y.series.pie.label.background.color;null==g&&(g=e.color);var u="top:"+h+"px;left:"+d+"px;";X('<div class="pieLabelBackground" style="position:absolute;width:'+c.width()+"px;height:"+c.height()+"px;"+u+"background-color:"+g+';"> </div>').insertBefore(c).css("opacity",Y.series.pie.label.background.opacity)}}}}(),ctx.restore()}}function g(e){0<Y.series.pie.innerRadius&&(e.save(),innerRadius=1<Y.series.pie.innerRadius?Y.series.pie.innerRadius:o*Y.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=Y.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=Y.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function u(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}function f(e){t("plothover",e)}function k(e){t("plotclick",e)}function t(e,t){var i=n.offset(),s=function(e,t){for(var i=n.getData(),s=n.getOptions(),a=1<s.series.pie.radius?s.series.pie.radius:o*s.series.pie.radius,r=0;r<i.length;++r){var l=i[r];if(l.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,a,l.startAngle,l.startAngle+l.angle,!1),ctx.closePath(),x=e-w,y=t-P,ctx.isPointInPath){if(ctx.isPointInPath(e-w,t-P))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:r}}else if(p1X=a*Math.cos(l.startAngle),p1Y=a*Math.sin(l.startAngle),p2X=a*Math.cos(l.startAngle+l.angle/4),p2Y=a*Math.sin(l.startAngle+l.angle/4),p3X=a*Math.cos(l.startAngle+l.angle/2),p3Y=a*Math.sin(l.startAngle+l.angle/2),p4X=a*Math.cos(l.startAngle+l.angle/1.5),p4Y=a*Math.sin(l.startAngle+l.angle/1.5),p5X=a*Math.cos(l.startAngle+l.angle),p5Y=a*Math.sin(l.startAngle+l.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],u(arrPoly,arrPoint))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:r};ctx.restore()}}return null}(parseInt(t.pageX-i.left),parseInt(t.pageY-i.top));if(Y.grid.autoHighlight)for(var a=0;a<d.length;++a){var r=d[a];r.auto!=e||s&&r.series==s.series||m(r.series)}s&&function(e,t){"number"==typeof e&&(e=series[e]);var i=A(e);-1==i?(d.push({series:e,auto:t}),n.triggerRedrawOverlay()):t||(d[i].auto=!1)}(s.series,e);var l={pageX:t.pageX,pageY:t.pageY};b.trigger(e,[l,s])}function m(e){null==e&&(d=[],n.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var t=A(e);-1!=t&&(d.splice(t,1),n.triggerRedrawOverlay())}function A(e){for(var t=0;t<d.length;++t)if(d[t].series==e)return t;return-1}function I(e,t){var s,a=e.getOptions(),r=1<a.series.pie.radius?a.series.pie.radius:o*a.series.pie.radius;for(t.save(),t.translate(w,P),t.scale(1,a.series.pie.tilt),i=0;i<d.length;++i)(s=d[i].series).angle<0||(t.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",t.beginPath(),1e-9<Math.abs(s.angle-2*Math.PI)&&t.moveTo(0,0),t.arc(0,0,r,s.startAngle,s.startAngle+s.angle,!1),t.closePath(),t.fill());g(t),t.restore()}n.hooks.processOptions.push(function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),1<t.series.pie.tilt&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(s),e.hooks.drawOverlay.push(I),e.hooks.draw.push(r))}),n.hooks.bindEvents.push(function(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(f),i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(k)})},options:Y,name:"pie",version:"1.0"})}(jQuery);